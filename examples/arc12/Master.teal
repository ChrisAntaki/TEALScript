#pragma version 8
b main
abi_route_createVault:
txna ApplicationArgs 1
btoi
txnas Accounts
txn GroupIndex
int 1
-
callsub createVault
int 1
return
createVault:
proto 2 0
frame_dig -1 // receiver: Account
box_get
swap
pop
assert
frame_dig -2 // mbrPayment: PayTxn
gtxns Receiver
global CurrentApplicationAddress
==
assert
frame_dig -2 // mbrPayment: PayTxn
gtxns Sender
txn Sender
==
assert
frame_dig -2 // mbrPayment: PayTxn
gtxns CloseRemainderTo
global ZeroAddress
==
assert
global CurrentApplicationAddress
acct_params_get AcctMinBalance
assert
store 0 // preCreateMBR: uint64
itxn_begin
int appl
itxn_field TypeEnum
method "create(account,account)void"
itxn_field ApplicationArgs
int NoOp
itxn_field OnCompletion
int 0
itxn_field Fee
frame_dig -1 // receiver: Account
itxn_field Accounts
int 1
itob
itxn_field ApplicationArgs
txn Sender
itxn_field Accounts
int 2
itob
itxn_field ApplicationArgs
txna Applications 0
app_params_get AppClearStateProgram
assert
itxn_field ClearStateProgram
byte b64 CCADAAEEJgMHY3JlYXRvcghyZWNlaXZlcgZtYXN0ZXJCAe6KAQCL/yhkEkSxI7IQi/+yBzIKcwFEsggisgExALIJszEWIwg1ADQAOBgqZBJEiTYaARfAHDYaAhfAHIgAAiNDigIAKIv+ZymL/2cqMg1niTYaARfAHDYaAhfAHDYaAxfAMDYaBBfAHIgAAiNDigQAMQApZBJEi/6AIMf8zbJY8NQYnCv4ttaO5pdQhkKwrQAfMfy5GMNUuoWaEkQyCnMBRDUBsSSyEIv/shSL/bIRIrISi/+yFSKyAbOL/Ra8NAEyCnMBRAk1ArEjshCL/rIHNAIxAQmyCCKyAbOxI7IQMQCyBzEBsggisgGzMgpzCUQiEkEABYv8iP8GiTYaARfAMDEWIwmIAAIjQ4oCAIv/Fr5MSESL/jgAMQASRIv+OAcyChJEMgpzAUQ1A4v/FjEAv7EkshAyCrIUIrISIrIBi/+yEbOL/jgIMgpzAUQ0AwkSRIk2GgEXwDA2GgIXwBw2GgMXwByIAAIjQ4oDAIv/Fr5MSESL/Yv/Fr5EEkQxAClkEkQoZIv+EkQyCnMBRDUEi/8WvLEkshAxALIUIrIBMgqL/3AARLISi/+yETEAshWzsSOyEIv9sgc0BDIKcwFECbIIIrIBszIKcwlEIhJBAAWL/oj+KomIAAIjQ4oAADIKcwBEIhJEMQAyCRJEiYAEwTFcWYAEj0xWPYAEcZebQIAEKRxRYoAEJDeNPDYaAI4F/hT+Nf7g/zj/vA==
itxn_field ApprovalProgram
itxn_submit
itxn CreatedApplicationID
store 1 // vault: Application
itxn_begin
int pay
itxn_field TypeEnum
load 1 // vault: Application
app_params_get AppAddress
assert
itxn_field Receiver
global MinBalance
itxn_field Amount
int 0
itxn_field Fee
itxn_submit
frame_dig -1 // receiver: Account
load 1 // vault: Application
itob
box_put
frame_dig -2 // mbrPayment: PayTxn
gtxns Amount
global CurrentApplicationAddress
acct_params_get AcctMinBalance
assert
load 0 // preCreateMBR: uint64
-
global MinBalance
+
==
assert
load 1 // vault: Application
itob
byte 0x151f7c75
swap
concat
retsub
abi_route_verifyAxfer:
txna ApplicationArgs 1
btoi
txnas Accounts
txn GroupIndex
int 1
-
txna ApplicationArgs 2
btoi
txnas Applications
callsub verifyAxfer
int 1
return
verifyAxfer:
proto 3 0
frame_dig -1 // receiver: Account
box_get
swap
pop
assert
frame_dig -1 // receiver: Account
box_get
assert
btoi
frame_dig -3 // vault: Application
==
assert
frame_dig -2 // vaultAxfer: AssetTransferTxn
gtxns AssetReceiver
frame_dig -3 // vault: Application
app_params_get AppAddress
assert
==
assert
frame_dig -2 // vaultAxfer: AssetTransferTxn
gtxns AssetCloseTo
global ZeroAddress
==
assert
retsub
abi_route_getVaultId:
txna ApplicationArgs 1
btoi
txnas Accounts
callsub getVaultId
int 1
return
getVaultId:
proto 1 0
frame_dig -1 // receiver: Account
box_get
assert
btoi
itob
byte 0x151f7c75
swap
concat
retsub
abi_route_getVaultAddr:
txna ApplicationArgs 1
btoi
txnas Accounts
callsub getVaultAddr
int 1
return
getVaultAddr:
proto 1 0
frame_dig -1 // receiver: Account
box_get
swap
pop
assert
byte 0x151f7c75
swap
concat
retsub
abi_route_deleteVault:
txna ApplicationArgs 1
btoi
txnas Applications
txna ApplicationArgs 2
btoi
txnas Accounts
callsub deleteVault
int 1
return
deleteVault:
proto 2 0
txn Fee
int 0
==
assert
frame_dig -1 // vault: Application
txn Sender
box_get
assert
btoi
==
assert
frame_dig -1 // vault: Application
byte "creator"
app_global_get_ex
assert
store 2 // vaultCreator: Account
load 2 // vaultCreator: Account
frame_dig -2 // creator: Account
==
assert
global CurrentApplicationAddress
acct_params_get AcctMinBalance
assert
store 3 // preDeleteMBR: uint64
itxn_begin
int appl
itxn_field TypeEnum
method "delete()void"
itxn_field ApplicationArgs
frame_dig -1 // vault: Application
itxn_field ApplicationID
int DeleteApplication
itxn_field OnCompletion
int 0
itxn_field Fee
itxn_submit
txn Sender
box_del
itxn_begin
int pay
itxn_field TypeEnum
load 2 // vaultCreator: Account
itxn_field Receiver
load 3 // preDeleteMBR: uint64
global CurrentApplicationAddress
acct_params_get AcctMinBalance
assert
-
itxn_field Amount
int 0
itxn_field Fee
itxn_submit
retsub
main:
method "createVault(account,pay)uint64"
method "verifyAxfer(account,axfer,application)void"
method "getVaultId(account)uint64"
method "getVaultAddr(account)address"
method "deleteVault(application,account)void"
txna ApplicationArgs 0
match abi_route_createVault abi_route_verifyAxfer abi_route_getVaultId abi_route_getVaultAddr abi_route_deleteVault